{
  "$schema": "https://json-schema.org/draft/2019-09/schema",
  "$id": "Form.json",
  "$comment": "$id should be URL where the schema is available.",
  "description": "Nettskjema form metadata",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "title",
    "formId",
    "editors",
    "elements",
    "version",
    "versionMinor",
    "createdBy",
    "openFrom",
    "modifiedBy",
    "createdDate",
    "languageCode",
    "modifiedDate",
    "respondentGroup",
    "collectsPersonalData",
    "sensitivePersonalDataCollected"
  ],
  "properties": {
    "$schema": {
      "description": "Which schema conforms to.",
      "type": "string"
    },
    "theme": {
      "description": "Which theme was used when collected.",
      "type": "string"
    },
    "title": {
      "description": "Title of the skjema.",
      "type": "string"
    },
    "formId": {
      "description": "Unique identifier for the skjema.",
      "type": "integer"
    },
    "version": {
      "description": "An identifier which format is used. Can be used to find correct version of this schema.",
      "const": "2024-09"
    },
    "versionMinor": {
      "description": "Minor version of the schema. Increased for non-breaking changes. Current version is 2",
      "type": "integer"
    },
    "datasets": {
      "description": "What datasets should be generated for this form.",
      "type": "array",
      "items": {
        "type": "string",
        "enum": ["csv", "spss", "json"]
      }
    },
    "permissions": {
      "description": "Permissions required for dataset and APIs",
      "type": "object",
      "additionalProperties": false,
      "required": ["datasets", "api"],
      "properties": {
        "datasets": {
          "description": "What group should be required to view generated datasets.",
          "type": "string"
        },
        "api": {
          "description": "Which groups should have API access to the form.",
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "editors": {
      "description": "Editors of the skjema.",
      "type": "array",
      "items": {
        "$ref": "#/$defs/editor"
      }
    },
    "elements": {
      "description": "Elements in this skjema.",
      "type": "array",
      "items": {
        "$ref": "#/$defs/element"
      }
    },
    "openFrom": {
      "description": "The date the form is opened.",
      "type": ["string", "null"]
    },
    "openTo": {
      "description": "The date the form is closed.",
      "type": "string"
    },
    "createdBy": {
      "$ref": "#/$defs/editor"
    },
    "modifiedBy": {
      "$ref": "#/$defs/editor"
    },
    "createdDate": {
      "description": "When this skjema was created.",
      "type": "string"
    },
    "languageCode": {
      "description": "Language code for the skjema.",
      "type": "string"
    },
    "modifiedDate": {
      "description": "When was the form last modified.",
      "type": "string"
    },
    "isConsentForm": {
      "description": "Is this a consent form.",
      "type": "boolean"
    },
    "projectName": {
      "description": "Which TSD project does the form belong to.",
      "type": "string"
    },
    "respondentGroup": {
      "description": "What sort of authentication is required to answer.",
      "$comment": "https://github.uio.no/IT-NETTSKJEMA/nettskjema-api/blob/master/src/main/java/no/uio/webapps/nettskjema/api/v3/form/enums/RespondentGroup.java",
      "type": "string",
      "enum": [
        "ALL",
        "FEIDE",
        "INVITED",
        "ID_PORTEN_LEVEL_3",
        "ID_PORTEN_LEVEL_3_SIGNING",
        "ID_PORTEN_LEVEL_4",
        "ID_PORTEN_LEVEL_4_SIGNING",
        "HELSENORGE",
        "HELSENORGE_SIGNING"
      ]
    },
    "afterDeliveryForwardFormIds": {
      "description": "A comma-separated list of formIds for forwarding after delivery. If both `redirectToForm` and `afterDeliveryForwardFormIds` are set, `redirectToForm will have priority after delivery.",
      "$comment": "If there is multiple values one is picked on random.",
      "type": ["string", "null"]
    },
    "deliveryDestination": {
      "description": "Where the form will be delivered.",
      "$comment": "https://github.uio.no/IT-NETTSKJEMA/nettskjema-api/blob/master/src/main/java/no/uio/webapps/nettskjema/api/v3/form/enums/DeliveryDestination.java",
      "type": "string",
      "enum": ["TSD", "EDUCLOUD", "DATABASE", "DATABASE_ENCRYPTED"]
    },
    "collectsPersonalData": {
      "description": "Does the form collect personal data.",
      "type": "boolean"
    },
    "isSensitivePersonalDataCollected": {
      "description": "Has sensitive data been collected.",
      "type": "boolean"
    },
    "generatedDate": {
      "description": "When this form definition was generated.",
      "type": "string"
    },
    "formType": {
      "description": "The type of this form.",
      "enum": [
        "DEFAULT",
        "HIGH_SECURITY",
        "SIGN_UP",
        "MULTIPLE_CHOICE",
        "COURSE_EVALUATION"
      ]
    },
    "titleShort": {
      "description": "Short title for the form.",
      "type": ["string", "null"]
    },
    "netgroupsEditor": {
      "description": "Groups with editor permissions.",
      "type": "array",
      "items": {
        "$ref": "#/$defs/netgroup"
      }
    },
    "editorsContactUrl": {
      "description": "Contact url for editor of the form.",
      "type": ["string", "null"]
    },
    "maxSubmissionsForm": {
      "description": "The number a respondent is allowed to submit a submission",
      "type": ["integer", "null"]
    },
    "editorsContactEmail": {
      "description": "Contact email for the form.",
      "type": ["string", "null"]
    },
    "personsWithCopyPermission": {
      "description": "Persons with edit-permissions for the form.",
      "type": "array",
      "items": {
        "$ref": "#/$defs/editor"
      }
    },
    "netgroupsWithCopyPermission": {
      "description": "Groups with copy-permissions.",
      "type": "array",
      "items": {
        "$ref": "#/$defs/netgroup"
      }
    },
    "personalDataPurposeDescription": {
      "description": "Description of the purposes for collecting personal data",
      "type": ["string", "null"]
    },
    "personalDataSharedOutsideInstitutionWith": {
      "description": "Description of where else the personal data can be shared to, outside of formowner's institution.",
      "type": ["string", "null"]
    }
  },
  "$defs": {
    "editor": {
      "type": "object",
      "additionalProperties": false,
      "required": ["username", "type", "personId"],
      "properties": {
        "name": {
          "description": "Name of the editor.",
          "type": "string"
        },
        "email": {
          "description": "Email of the editor.",
          "type": "string"
        },
        "type": {
          "description": "User type",
          "$comment": "See https://github.uio.no/IT-NETTSKJEMA/nettskjema-api/blob/master/src/main/java/no/uio/webapps/nettskjema/api/v3/person/enums/UserType.java",
          "type": "string"
        },
        "personId": {
          "description": "Unique identifier for this person.",
          "type": "integer"
        },
        "username": {
          "description": "Username of the editor.",
          "type": "string"
        },
        "isSuperuser": {
          "description": "User is a super-user.",
          "type": "boolean"
        },
        "isSupportUser": {
          "description": "User is a support-user.",
          "type": "boolean"
        },
        "hasAccessForCourseEvaluation": {
          "description": "User has access to course evaluation form type.",
          "type": "boolean"
        }
      }
    },
    "netgroup": {
      "description": "Netgroup editor.",
      "type": "object",
      "required": ["netgroupId", "name"],
      "properties": {
        "netgroupId": {
          "description": "Identifier for the netgroup.",
          "type": "integer"
        },
        "name": {
          "description": "Name of the netgroup.",
          "type": "string"
        }
      }
    },
    "element": {
      "description": "Elements of the skjema.",
      "type": "object",
      "additionalProperties": false,
      "required": ["sequence", "elementId"],
      "properties": {
        "elementId": {
          "description": "Internal identifier for this element.",
          "type": ["integer", "null"]
        },
        "questionId": {
          "description": "Deprecated internal identifier. Use elementId for internal identifier instead",
          "type": ["integer", "null"]
        },
        "text": {
          "description": "The text of the element, e.g. question text or title for a matrix. May contain HTML entities and tags.",
          "type": "string"
        },
        "description": {
          "description": "Description of the element. May contain HTML entities and tags.",
          "type": "string"
        },
        "elementType": {
          "$ref": "#/$defs/elementType"
        },
        "dateFormat": {
          "$ref": "#/$defs/dateFormat"
        },
        "sequence": {
          "description": "Which question number is this.",
          "type": ["integer", "null"]
        },
        "maxSelectedAnswerOptions": {
          "description": "Max amountof options which can be selected.",
          "type": "integer"
        },
        "imageUrl": {
          "description": "Url of image if element type is IMAGE.",
          "type": ["string", "null"]
        },
        "altText": {
          "description": "Alt text for the element.",
          "type": ["string", "null"]
        },
        "linearScaleType": {
          "description": "Type for LINEAR_SCALE elements.",
          "type": "string"
        },
        "nationalIdNumberType": {
          "description": "Type for NATIONAL_ID_NUMBER elements.",
          "type": "string"
        },
        "repeatedNationalIdRequired": {
          "description": "An additional field for respondent to type their pid for double verification",
          "type": "boolean"
        },
        "nationalIdNumberOfLetters": {
          "description": "Number of letters in NATIONAL_ID_NUMBER elements.",
          "type": "integer"
        },
        "nationalIdNumberOfDigits": {
          "description": "Number of digits in NATIONAL_ID_NUMBER elements.",
          "type": "integer"
        },
        "isAutofill": {
          "description": "Element is auto-filled.",
          "type": "boolean"
        },
        "title": {
          "description": "Same content as text. Deprecated.",
          "type": "string"
        },
        "image": {
          "$ref": "#/$defs/image"
        },
        "isMandatory": {
          "description": "Element is mandatory.",
          "type": "boolean"
        },
        "isHorizontal": {
          "description": "Only applicable if element type is LINEAR_SCALE. Will render the scale horizontally instead of vertically.",
          "type": "boolean"
        },
        "isRangeMarksShown": {
          "description": "If range markers are enabled for LINEAR_SCALE elements.",
          "type": "boolean"
        },
        "externalElementId": {
          "description": "Codebook key for this element",
          "type": "string"
        },
        "minimumValue": {
          "description": "Minimum value for supported elements.",
          "type": "integer"
        },
        "maximumValue": {
          "description": "Maximum value for supported elements.",
          "type": "integer"
        },
        "sendAdditionalRecipientEmail": {
          "description": "Requires additionalRecipientEmail on answer option. Will send email to additionalRecipientEmail if the answer option is picked.",
          "type": "boolean"
        },
        "useForRedirectToForm": {
          "description": "This element affects if/where to redirect after form.",
          "type": "boolean"
        },
        "minimumValueText": {
          "description": "Description for minimum values.",
          "type": "string"
        },
        "midValueText": {
          "description": "Description for middle values.",
          "type": "string"
        },
        "maximumValueText": {
          "description": "Description for max values.",
          "type": "string"
        },
        "numberOfDecimals": {
          "description": "Number of decimals for NUMBER elements.",
          "type": "integer"
        },
        "routingReferenceIds": {
          "description": "Not used. Deprecated",
          "type": "array",
          "items": {
            "type": "integer"
          }
        },
        "answerOptions": {
          "description": "Answer options.",
          "type": "array",
          "items": {
            "$ref": "#/$defs/answerOption"
          }
        },
        "answerOptionsVisibilityFilter": {
          "description": "List of answerOptionIDs. This element becomes visible if one of the options is selected.",
          "type": "array",
          "items": [{ "$ref": "#/$defs/visibilityFilterItem" }],
          "minItems": 1
        },
        "subElements": {
          "type": "array",
          "items": [{ "$ref": "#/$defs/subElement" }]
        },
        "validationScripts": {
          "description": "Custom javascript to validate respondent input on elements. Only able to set by superuser.",
          "type": "array",
          "items": [{ "$ref": "#/$defs/validationScript" }]
        },
        "isAnswerHashed": {
          "description": "Boolean specifying if the answer should be hashed or not.",
          "type": "boolean"
        },
        "maxNumberOfCharacters": {
          "description": "Max characters allowed in supported answer types.",
          "type": "integer"
        },
        "isRandomizedOrder": {
          "description": "Order of sub-elements or sub-options are randomized.",
          "type": "boolean"
        }
      }
    },
    "subElement": {
      "description": "Sub-elements of an element.",
      "type": "object",
      "additionalProperties": false,
      "required": ["sequence"],
      "properties": {
        "subElementId": {
          "description": "Internal identifier for this sub-element",
          "type": "integer"
        },
        "questionId": {
          "description": "Deprecated internal identifier. Use elementId or subElementId for internal identifier instead",
          "type": "integer"
        },
        "sequence": {
          "description": "Which question number is this.",
          "type": "integer"
        },
        "description": {
          "description": "Description of the element. May contain HTML entities and tags.",
          "type": "string"
        },
        "text": {
          "description": "Question text. May contain HTML entities and tags.",
          "type": "string"
        },
        "isMandatory": {
          "description": "Element is mandatory.",
          "type": "boolean"
        },
        "externalElementId": {
          "description": "Codebook key for this element.",
          "type": "string"
        },
        "sendAdditionalRecipientEmail": {
          "description": "If answer option is picked, an email will be sent to additionalRecipientEmail. Requires sendAdditionalRecipientEmail.",
          "type": "boolean"
        }
      }
    },
    "answerOption": {
      "description": "Contained when question has multiple possible answers.",
      "type": "object",
      "additionalProperties": false,
      "required": [],
      "properties": {
        "text": {
          "description": "Text value for the answer option. May contain HTML entities and tags.",
          "type": "string"
        },
        "sequence": {
          "description": "Which answer number is this.",
          "type": "integer"
        },
        "answerOptionId": {
          "description": "Internal identifier for this answer option",
          "type": "integer"
        },
        "externalAnswerOptionId": {
          "description": "Codebook value for this answer option.",
          "type": "string"
        },
        "redirectToForm": {
          "description": "The form id the user will be redirected to after delivery, if this answer option was picked. If a form id is defined the element it belongs to will always have the `useForRedirectToForm` set to true. If both `redirectToForm` and `afterDeliveryForwardFormIds` is set, `useForRedirectToForm` has priority after delivery.",
          "type": "integer"
        },
        "isPreselected": {
          "description": "This value is preselected.",
          "type": "boolean"
        },
        "isCorrect": {
          "description": "This value is the correct value for this answer.",
          "type": "boolean"
        },
        "image": {
          "$ref": "#/$defs/image"
        },
        "imageUrl": {
          "description": "URL for image.",
          "type": "string"
        },
        "altText": {
          "description": "Alt-text for the element",
          "type": "string"
        },
        "additionalRecipientEmail": {
          "description": "If answer option is picked, an email will be sent to additionalRecipientEmail. Requires sendAdditionalRecipientEmail.",
          "type": "string"
        }
      }
    },
    "image": {
      "description": "Image.",
      "type": "object",
      "additionalProperties": false,
      "required": [],
      "properties": {
        "imageId": {
          "description": "Internal identifier for the image.",
          "type": "string"
        },
        "filename": {
          "description": "Filename for the image.",
          "type": "string"
        },
        "size": {
          "description": "Size of the image.",
          "type": "integer"
        },
        "mediaType": {
          "description": "Media type of the image.",
          "type": "string"
        }
      }
    },
    "validationScript": {
      "description": "Script for validating values.",
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "title": {
          "description": "Title of the script.",
          "type": "string"
        },
        "content": {
          "description": "Content of the script.",
          "type": "string"
        },
        "validationScriptId": {
          "description": "Internal identifier for the script.",
          "type": "integer"
        }
      }
    },
    "elementType": {
      "description": "Nettskjema question types.",
      "$comment": "https://github.uio.no/IT-NETTSKJEMA/nettskjema-api/blob/master/src/main/java/no/uio/webapps/nettskjema/api/v3/form/enums/ElementType.java",
      "type": "string",
      "enum": [
        "ACCORDION",
        "ATTACHMENT",
        "CHECKBOX",
        "DATE",
        "EMAIL",
        "HEADING",
        "IMAGE",
        "LINEAR_SCALE",
        "MATRIX_CHECKBOX",
        "MATRIX_RADIO",
        "NAME",
        "NATIONAL_ID_NUMBER",
        "NUMBER",
        "PAGE_BREAK",
        "PHONE",
        "QUESTION",
        "QUESTION_MULTILINE",
        "RADIO",
        "SELECT",
        "SUBMISSION_REFERENCE",
        "TEXT",
        "USERNAME"
      ]
    },
    "dateFormat": {
      "description": "Type of date collected.",
      "$comment": "https://github.uio.no/IT-NETTSKJEMA/nettskjema-api/blob/master/src/main/java/no/uio/webapps/nettskjema/api/v3/form/enums/DateFormat.java",
      "type": "string",
      "enum": ["DATE", "TIME", "DATE_TIME"]
    },
    "visibilityFilterItem": {
      "description": "Contains the codebook value of another element and its answer option id that this element is dependent on",
      "type": "object",
      "additionalProperties": false,
      "required": ["externalElementId", "externalAnswerOptionId"],
      "properties": {
        "externalElementId": {
          "description": "Codebook key for element",
          "type": "string"
        },
        "externalAnswerOptionId": {
          "description": "Codebook value for answer option.",
          "type": "string"
        }
      }
    },
    "useForRedirectToForm": {
      "description": "Is redirect to another form enabled for this element? If so, at least one answer option will have the `redirectToForm` with form id",
      "type": "boolean"
    }
  }
}
